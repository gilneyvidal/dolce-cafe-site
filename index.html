<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cardápio Dolce DC Café</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @font-face {
      font-family: "Dolato";
      src: url("https://res.cloudinary.com/dts-11-20-2023/image/upload/v1724967393/Dolato_de_Stato_Font_w9r96c.ttf") format("truetype");
      font-weight: normal;
      font-style: normal;
    }

    :root {
      --background-color: #392502;
      --orange: #f28c0d;
      --orange-dark: #d97b00;
      --text-color: #392502;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Calibri", Arial, sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
    }
    
    .menu-wrapper {
      position: relative;
      border: 5px solid var(--orange);
      border-radius: 16px;
      padding: 30px 25px 40px;
      background-color: var(--background-color);
      margin-bottom: 40px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.45);
    }

    .topo-img {
      display: block;
      width: 100%;
      height: auto;
      margin: 0 auto 20px;
    }
    .header-separator {
      border-top: 2px solid var(--orange);
      margin: 20px 0 10px;
    }
    .info-message {
      background-color: #fdf7f0;
      border-left: 4px solid var(--orange);
      padding: 12px 16px;
      margin-bottom: 20px;
      color: var(--text-color);
      font-size: 0.9rem;
      line-height: 1.4;
    }
    .menu {
      display: flex;
      flex-wrap: wrap;
    }
    .menu-col {
      flex: 1;
      min-width: 280px;
      padding: 0 20px;
    }
    .menu-col:not(:first-child) {
      border-left: 2px solid var(--orange);
    }
    .category-block {
      margin-bottom: 40px;
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.6s ease forwards;
    }
    .category-block h3 {
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: "Dolato", sans-serif;
      font-size: 1.4rem;
      font-weight: bold;
      font-style: italic;
      margin-top: 0;
      margin-bottom: 12px;
      color: #fff;
    }
    .category-block .category-icon {
      width: 32px;
      height: auto;
      filter: invert(45%) sepia(80%) saturate(600%) hue-rotate(-15deg) brightness(95%) contrast(90%);
    }
    .category-block .category-items {
      margin-top: 0;
    }
    .category-block .menu-row {
      display: grid;
      grid-template-columns: 2fr auto 40px auto;
      align-items: center;
      column-gap: 16px;
      padding: 5px 0;
      border-bottom: 1px dotted var(--orange);
      color: #fff;
    }
    .category-block .menu-row:last-child {
      border-bottom: none;
    }
    .category-block .menu-row span {
      font-size: 0.95rem;
      color: #fff;
    }
    .category-block .menu-row input[type="number"] {
      width: 55px;
      padding: 4px;
      font-size: 0.9rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .category-block:nth-of-type(1) { animation-delay: 0s; }
    .category-block:nth-of-type(2) { animation-delay: 0.1s; }
    .category-block:nth-of-type(3) { animation-delay: 0.2s; }
    .category-block:nth-of-type(4) { animation-delay: 0.3s; }
    .category-block:nth-of-type(5) { animation-delay: 0.4s; }
    .category-block:nth-of-type(6) { animation-delay: 0.5s; }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .footer {
      text-align: center;
      color: #fff;
      font-size: 0.9rem;
      margin-top: 30px;
    }
    .footer a {
      color: var(--orange);
      text-decoration: none;
    }
    .footer a:hover {
      text-decoration: underline;
    }
    .cart-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: var(--orange);
      color: var(--background-color);
      border: none;
      border-radius: 24px;
      padding: 12px 20px;
      font-size: 0.9rem;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      transition: background-color 0.2s ease;
    }
    .cart-button:hover {
      background-color: var(--orange-dark);
    }
    .qty-indicator {
      font-size: 0.9rem;
      color: #fff;
      margin-left: 4px;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: 20px;
    }
    .cart-section {
      margin-top: 30px;
      background-color: #fdf7f0;
      border: 2px solid var(--orange);
      border-radius: 8px;
      padding: 20px;
      max-width: 480px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.35);
      color: var(--text-color);
    }
    .cart-section h2 {
      font-family: "Dolato", sans-serif;
      font-weight: bold;
      font-style: italic;
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 1.4rem;
      text-align: center;
    }
    .cart-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      font-size: 0.95rem;
    }
    .cart-item-name {
      flex: 2;
    }
    .cart-item-price {
      flex: 1;
      text-align: right;
    }
    .cart-item-controls {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 5px;
    }
    .cart-item-controls button {
      width: 28px;
      height: 28px;
      border: 1px solid var(--orange);
      background-color: var(--orange);
      color: #fff;
      font-weight: bold;
      border-radius: 4px;
      cursor: pointer;
    }
    .cart-total {
      font-weight: bold;
      text-align: right;
      margin-top: 10px;
    }
    .add-btn {
      width: 32px;
      height: 28px;
      border: 1px solid var(--orange);
      background-color: var(--orange);
      color: #fff;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      text-align: center;
      padding: 0;
    }
    .add-btn:hover {
      background-color: var(--orange-dark);
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #fff; /* Adiciona cor branca aos labels */
    }
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
      color: #000;
    }
    button[type="submit"] {
      display: block;
      width: 100%;
      background-color: var(--orange);
      color: #fff;
      border: none;
      padding: 12px 20px;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 15px;
    }
    button[type="submit"]:hover {
      background-color: var(--orange-dark);
    }
    @media (max-width: 900px) {
      .menu {
        flex-direction: column;
      }
      .menu-col {
        min-width: 100%;
        padding: 0 12px;
        border-left: none;
        border-top: 2px solid var(--orange);
        margin-top: 20px;
        box-sizing: border-box;
      }
      .menu-col:first-child {
        border-top: none;
        margin-top: 0;
      }
      .category-block h3 {
        font-size: 1.2rem;
      }
      .category-block .menu-row,
      .category-column .menu-row {
        grid-template-columns: 2fr auto 40px auto;
        column-gap: 14px;
      }
      .container {
        padding: 10px;
      }
      .menu-wrapper {
        padding: 20px 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="menu-wrapper">
      <header>
        <img src="https://res.cloudinary.com/dts-11-20-2023/image/upload/v1724967393/topo.png" alt="Topo decorativo" class="topo-img" />
      </header>
      <div class="header-separator"></div>
      <div class="info-message">
        Clique no botão <strong>“+”</strong> para adicionar um produto à sua sacola. Os itens adicionados ficam no <strong>carrinho</strong> ao final da página, junto ao formulário de pedido. Você pode ajustar as quantidades e finalizar seu pedido lá mesmo.
      </div>
      <section id="menu" class="menu">
        <div class="loading-message text-white">Carregando cardápio...</div>
      </section>
    </div>
    <section id="cart-section" class="cart-section" style="display:none;">
      <h2>Carrinho</h2>
      <div id="cartItems"></div>
      <p class="cart-total">Total: R$ <span id="cartTotal">0,00</span></p>
    </section>
    <button id="cartButton" class="cart-button" style="display:none;">
      Ver carrinho (<span id="cartCount">0</span>)
    </button>
    <section id="order-form" class="order-form">
      <h2>Fazer pedido</h2>
      <form id="orderForm">
        <div class="form-group">
          <label for="customerName">Nome:</label>
          <input type="text" id="customerName" required />
        </div>
        <div class="form-group">
          <label for="customerPhone">Telefone:</label>
          <input type="tel" id="customerPhone" required />
        </div>
        <div class="form-group">
          <label for="customerRoom">Quarto:</label>
          <input type="text" id="customerRoom" required />
        </div>
        <div class="form-group">
          <label for="customerSector">Setor:</label>
          <select id="customerSector" required></select>
        </div>
        <div class="form-group">
          <label for="paymentMethod">Forma de pagamento:</label>
          <select id="paymentMethod" required>
            <option value="Dinheiro">Dinheiro</option>
            <option value="Cartão de Crédito">Cartão de crédito</option>
            <option value="Cartão de Débito">Cartão de débito</option>
          </select>
        </div>
        <div class="form-group">
          <label for="consumptionType">Serviço:</label>
          <select id="consumptionType" required>
            <option value="Comer no local">Comer no local</option>
            <option value="Retirar no balcão">Retirar no balcão</option>
          </select>
        </div>
        <button type="submit">Enviar pedido via WhatsApp</button>
      </form>
    </section>
    <footer class="footer">
      <p>Dolce Café | Ramal: 0830 | Horário: 6:00 às 23:00</p>
      <p>© 2025 Dolce Café. Todos os direitos reservados.</p>
      <p>
        Desenvolvido pela empresa Vidal Design Solutions –
        <a href="https://wa.me/5511968649673" target="_blank">11968649673</a>
      </p>
    </footer>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, doc, getDoc, onSnapshot, collection, query, where, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    // A sua configuração do Firebase aqui
    const firebaseConfig = {
      apiKey: "AIzaSyAVYypw3seGUZcwbvUMz8aIWTMlqbmADsY",
      authDomain: "dolce-cafe-app.firebaseapp.com",
      projectId: "dolce-cafe-app",
      storageBucket: "dolce-cafe-app.firebasestorage.app",
      messagingSenderId: "996006182378",
      appId: "1:996006182378:web:bdbcdc42424a2e4dad8693",
    };

    const appId = firebaseConfig.projectId;

    let db;
    let auth;
    let userId;
    const cart = {};
    const qtyIndicators = {};

    document.addEventListener('DOMContentLoaded', () => {
      try {
        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);

        onAuthStateChanged(auth, async (user) => {
          if (user) {
            userId = user.uid;
            console.log("Usuário autenticado:", userId);
            await loadMenu();
          } else {
            console.log("Autenticando anonimamente...");
            await signInAnonymously(auth);
          }
        });

      } catch (error) {
        console.error("Erro ao inicializar o Firebase. Verifique a configuração.", error);
        document.getElementById('menu').innerHTML = '<div class="text-red-500 font-bold">Erro ao carregar o cardápio. Verifique sua configuração do Firebase.</div>';
      }

      function updateIndicators() {
        Object.keys(qtyIndicators).forEach(name => {
          const span = qtyIndicators[name];
          span.textContent = cart[name] ? cart[name].quantity : '';
        });
        const cartButton = document.getElementById('cartButton');
        const cartCount = document.getElementById('cartCount');
        const totalItems = Object.values(cart).reduce((sum, e) => sum + e.quantity, 0);
        if (totalItems > 0) {
          cartButton.style.display = 'block';
          cartCount.textContent = totalItems;
        } else {
          cartButton.style.display = 'none';
          cartCount.textContent = '0';
        }
      }

      function addToCart(itemName, itemPrice) {
        if (!cart[itemName]) cart[itemName] = { quantity: 1, price: itemPrice };
        else cart[itemName].quantity++;
        renderCart();
        updateIndicators();
      }

      function updateCart(itemName, delta) {
        if (!cart[itemName]) return;
        cart[itemName].quantity += delta;
        if (cart[itemName].quantity <= 0) delete cart[itemName];
        renderCart();
        updateIndicators();
      }

      function renderCart() {
        const cartSection = document.getElementById('cart-section');
        const cartItemsContainer = document.getElementById('cartItems');
        const cartTotalSpan = document.getElementById('cartTotal');
        cartItemsContainer.innerHTML = '';
        let total = 0;
        const names = Object.keys(cart);
        if (names.length === 0) {
          cartSection.style.display = 'none';
          cartTotalSpan.textContent = '0,00';
          return;
        }
        cartSection.style.display = 'block';
        names.forEach(name => {
          const entry = cart[name];
          const priceNum = parseFloat(entry.price.replace(',', '.'));
          const itemTotal = priceNum * entry.quantity;
          total += itemTotal;

          const row = document.createElement('div');
          row.className = 'cart-item';

          const nameSpan = document.createElement('span');
          nameSpan.className = 'cart-item-name';
          nameSpan.textContent = name;

          const priceSpan = document.createElement('span');
          priceSpan.className = 'cart-item-price';
          priceSpan.textContent = `R$ ${entry.price}`;

          const controls = document.createElement('div');
          controls.className = 'cart-item-controls';
          const minusBtn = document.createElement('button');
          minusBtn.textContent = '−';
          minusBtn.addEventListener('click', () => updateCart(name, -1));
          const qtySpan = document.createElement('span');
          qtySpan.textContent = entry.quantity;
          qtySpan.style.minWidth = '20px';
          qtySpan.style.textAlign = 'center';
          const plusBtn = document.createElement('button');
          plusBtn.textContent = '+';
          plusBtn.addEventListener('click', () => updateCart(name, 1));

          controls.appendChild(minusBtn);
          controls.appendChild(qtySpan);
          controls.appendChild(plusBtn);

          row.appendChild(nameSpan);
          row.appendChild(priceSpan);
          row.appendChild(controls);
          cartItemsContainer.appendChild(row);
        });
        const totalStr = total.toFixed(2).replace('.', ',');
        cartTotalSpan.textContent = totalStr;
      }

      function createCategoryBlock(category) {
        if (!category) return null;

        const block = document.createElement('div');
        block.className = 'category-block';

        const h3 = document.createElement('h3');
        const iconImg = document.createElement('img');
        iconImg.src = category.icon;
        iconImg.alt = '';
        iconImg.className = 'category-icon';
        const titleSpan = document.createElement('span');
        titleSpan.textContent = category.name;
        h3.appendChild(iconImg);
        h3.appendChild(titleSpan);
        block.appendChild(h3);

        const itemList = document.createElement('div');
        itemList.className = 'category-items';
        category.items.forEach(item => {
          const row = document.createElement('div');
          row.className = 'menu-row';

          const nameBox = document.createElement('div');
          const nameSpan = document.createElement('span');
          nameSpan.textContent = item.name;
          nameSpan.style.display = 'block';

          nameBox.appendChild(nameSpan);

          if (item.description) {
            const desc = document.createElement('small');
            desc.textContent = item.description;
            desc.style.display = 'block';
            desc.style.marginTop = '2px';
            desc.style.opacity = '0.9';
            desc.style.color = '#ddd';
            nameBox.appendChild(desc);
          }

          const priceSpan = document.createElement('span');
          priceSpan.textContent = `R$ ${item.price}`;

          const addBtn = document.createElement('button');
          addBtn.type = 'button';
          addBtn.textContent = '+';
          addBtn.className = 'add-btn';
          addBtn.addEventListener('click', () => addToCart(item.name, item.price));

          const qtySpan = document.createElement('span');
          qtySpan.className = 'qty-indicator';
          qtyIndicators[item.name] = qtySpan;

          row.appendChild(nameBox);
          row.appendChild(priceSpan);
          row.appendChild(addBtn);
          row.appendChild(qtySpan);
          itemList.appendChild(row);
        });
        block.appendChild(itemList);
        return block;
      }

      function renderMenu(menuData) {
        const menuContainer = document.getElementById('menu');
        menuContainer.innerHTML = '';
        Object.keys(qtyIndicators).forEach(key => delete qtyIndicators[key]);

        const leftCategories = ['Salgados', 'Comidinhas', 'Doces'];
        const rightCategories = ['Cafeteria', 'Bebidas', 'Petit Four', 'Combo Promocional'];

        const leftCol = document.createElement('div');
        leftCol.className = 'menu-col';
        leftCategories.forEach(name => {
          const category = menuData.find(cat => cat.name === name);
          const block = createCategoryBlock(category);
          if (block) leftCol.appendChild(block);
        });

        const rightCol = document.createElement('div');
        rightCol.className = 'menu-col';
        rightCategories.forEach(name => {
          const category = menuData.find(cat => cat.name === name);
          const block = createCategoryBlock(category);
          if (block) rightCol.appendChild(block);
        });
        menuContainer.appendChild(leftCol);
        menuContainer.appendChild(rightCol);
      }

      function renderSectors(sectors) {
        const sectorSelect = document.getElementById('customerSector');
        sectorSelect.innerHTML = '';
        sectors.forEach(sector => {
          const option = document.createElement('option');
          option.value = sector;
          option.textContent = sector;
          sectorSelect.appendChild(option);
        });
      }

      async function loadMenu() {
        if (!db) return;
        const menuRef = doc(db, `artifacts/${appId}/public/data/menu`);
        const sectorsRef = doc(db, `artifacts/${appId}/public/data/sectors`);
        try {
            const menuDoc = await getDoc(menuRef);
            const sectorsDoc = await getDoc(sectorsRef);

            if (menuDoc.exists() && sectorsDoc.exists()) {
                const menuData = menuDoc.data().categories;
                const sectorsData = sectorsDoc.data().list;
                renderMenu(menuData);
                renderSectors(sectorsData);
            } else {
                document.getElementById('menu').innerHTML = '<div class="text-white">Nenhum dado de cardápio encontrado.</div>';
            }
        } catch (error) {
            console.error("Erro ao carregar os dados:", error);
            document.getElementById('menu').innerHTML = `<div class="text-white">Erro ao carregar o cardápio: ${error.message}</div>`;
        }
      }

      function buildWhatsAppURL(number, text) {
        const encoded = encodeURIComponent(text);
        const isMobile = /Android|iPhone|iPad|iPod|Windows Phone/i.test(navigator.userAgent);
        return isMobile
          ? `https://wa.me/${number}?text=${encoded}`
          : `https://web.whatsapp.com/send?phone=${number}&text=${encoded}`;
      }

      const orderForm = document.getElementById('orderForm');
      orderForm.addEventListener('submit', event => {
        event.preventDefault();

        const now = new Date();
        const hour = now.getHours();
        const minute = now.getMinutes();
        const isWithinOperatingHours = (hour >= 6 && hour < 23) || (hour === 23 && minute === 0);

        if (!isWithinOperatingHours) {
          showModalMessage('Desculpe, a loja está fechada. Nosso horário de atendimento é das 6:00 às 23:00.');
          return;
        }

        const orderLines = [];
        let totalOrder = 0;
        const names = Object.keys(cart);

        names.forEach(name => {
          const entry = cart[name];
          const qty = entry.quantity;
          const priceStr = entry.price;
          const priceNum = parseFloat(entry.price.replace(',', '.'));
          const itemTotal = priceNum * qty;
          totalOrder += itemTotal;
          const itemTotalStr = itemTotal.toFixed(2).replace('.', ',');
          orderLines.push(`${name}: ${qty} x R$ ${priceStr} = R$ ${itemTotalStr}`);
        });

        if (orderLines.length === 0) {
          showModalMessage('Selecione pelo menos um item do cardápio.');
          return;
        }

        const customerName = document.getElementById('customerName').value.trim();
        const customerPhone = document.getElementById('customerPhone').value.trim();
        const customerRoom = document.getElementById('customerRoom').value.trim();
        const customerSector = document.getElementById('customerSector').value;
        const paymentMethod = document.getElementById('paymentMethod').value;
        const consumptionType = document.getElementById('consumptionType').value;

        const totalStr = totalOrder.toFixed(2).replace('.', ',');

        const message =
          `Olá, gostaria de fazer um pedido:\n\n` +
          `Itens selecionados:\n${orderLines.join('\n')}\n\n` +
          `Total do pedido: R$ ${totalStr}\n\n` +
          `Nome: ${customerName}\n` +
          `Telefone: ${customerPhone}\n` +
          `Quarto: ${customerRoom}\n` +
          `Setor: ${customerSector}\n` +
          `Forma de pagamento: ${paymentMethod}\n` +
          `Serviço: ${consumptionType}`;

        const whatsappNumber = '5511918360016';

        const whatsappURL = buildWhatsAppURL(whatsappNumber, message);

        window.open(whatsappURL, '_blank');
      });

      const cartButtonElem = document.getElementById('cartButton');
      cartButtonElem.addEventListener('click', () => {
        const cartSection = document.getElementById('cart-section');
        cartSection.scrollIntoView({ behavior: 'smooth' });
      });

      function showModalMessage(message) {
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-[2000]';
        modal.innerHTML = `
          <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm mx-auto text-center">
            <p class="text-lg text-gray-800">${message}</p>
            <button id="close-modal" class="mt-4 px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600">Fechar</button>
          </div>
        `;
        document.body.appendChild(modal);

        document.getElementById('close-modal').addEventListener('click', () => {
          modal.remove();
        });
      }
    });
  </script>
</body>
</html>
